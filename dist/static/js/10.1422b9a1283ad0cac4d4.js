webpackJsonp([10],{"+RB0":function(t,e,a){"use strict";e.a=function(t){var e=t.target_name,a=t.target_teststra,n=t.target_cycle,s=t.userName,i=t.target_starttime,o=t.target_url,l=t.target_ip;return Object(r.a)({method:"post",url:"/ZY/task/addTask",data:{target_name:e,target_teststra:a,target_cycle:n,userName:s,target_starttime:i,target_url:o,target_ip:l}})};var r=a("vLgD")},R9Aj:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a("lC5x"),n=a.n(r),s=a("J0Oq"),i=a.n(s),o=a("aA9S"),l=a.n(o),c=(a("7Nmy"),a("+RB0")),u=a("TIfe"),p=a("sxu/"),d=a("sMcl"),g=a("y6zN"),m=a("MsTT"),_=a("V2Kl"),f=a("vLgD");function h(t){var e=t.target_name,a=t.target_id;return Object(f.a)({method:"post",url:"/ZY/report/exportPDF",data:{target_name:e,target_id:a}})}var k=a("aJHV");var y={flag:1},v={flag:2},w={0:"进行中",1:"已完成","-2":"失败"},b={now:"立即",day:"每天",month:"每月",year:"每年"},L={medium:"常规策略",high:"深度策略"},x={components:{page:p.a,Modals:m.a},watch:{"data.target_url":function(t){this.data.target_ip=this.urlIpMap[t]}},data:function(){var t=this;return{modalDeleter:!1,modal_loading:!1,fileName:"",href:"",pageLoading:!1,pagesLoading:!1,loading:!1,display:!1,height:"355px",format:[{label:"任务名称",type:"input",prop:"target_name"},{label:"策略",type:"select",prop:"target_teststra",option:[]},{label:"周期",type:"select",prop:"target_cycle",option:[]},{label:"开始时间",type:"datetime",prop:"target_starttime"},{label:"资产url",type:"select",prop:"target_url",option:[]},{label:"资产ip",type:"select",prop:"target_ip",option:[]}],data:{target_name:"渗透测试+"+Object(g.a)(new Date),target_teststra:"medium",target_starttime:new Date,target_cycle:"now",target_url:"",target_ip:"",userName:Object(u.b)()},rules:{target_name:[{required:!0,message:"请填写任务名称",trigger:"blur"}],target_url:[{validator:function(e,a,r){a||t.data.target_ip?r():r(new Error("url或者ip请至少填写一项"))},trigger:"change"}],target_ip:[{validator:function(e,a,r){a||t.data.target_url?r():r(new Error("url或者ip请至少填写一项"))},trigger:"change"}]},value:"",loadingtasksList:[],loadingtasks:[{title:"任务名称",key:"target_name",align:"center",width:250},{title:"任务状态",key:"target_struts",align:"center",width:100,render:function(t,e){return t("span",w[e.row.target_struts])}},{title:"任务目标",key:"target_url",align:"center"},{title:"周期",key:"target_cycle",align:"center",width:60,render:function(t,e){return t("span",b[e.row.target_cycle])}},{title:"策略",key:"target_teststra",align:"center",width:150,render:function(t,e){return t("span",L[e.row.target_teststra])}},{title:"开始时间",key:"target_starttime",align:"center",width:200,render:function(t,e){return t("span",Object(g.a)(new Date(e.row.target_starttime.time)))}},{title:"结束时间",key:"target_endtime",align:"center",width:200,render:function(t,e){return e.row.target_endtime?t("span",Object(g.a)(new Date(e.row.target_endtime.time))):t("span","")}},{title:"报告名称",key:"pdf_name",align:"center"},{title:"操作",align:"center",width:200,render:function(e,a){return e("div",[e("Button",{props:{type:"primary",size:"small",icon:"stop"},on:{click:function(){t.$router.push({name:"process",params:{targetInfo:a.row,target_id:a.row.target_id}})}}}),e("a",{attrs:{type:"application/pdf",href:a.row.export_url?""+a.row.export_url:null,download:!!a.row.pdf_name&&a.row.pdf_name},style:{backgroundColor:"#19be6b",display:"inline-block",marginBottom:"0",fontWeight:"400",textAlign:"center",verticalAlign:"middle",touchAction:"manipulation",cursor:"pointer",backgroundImage:"none",border:"1px solid transparent",whiteSpace:"nowrap",lineHeight:"1.5",color:"#fff",padding:"2px 7px",borderRadius:"3px",marginLeft:"5px"},on:{click:function(e){""===a.row.export_url&&t.$Modal.confirm({title:"请输入报告名称",render:function(e){return e("Input",{props:{value:t.fileName,autofocus:!0,placeholder:"请输入文件名"},on:{input:function(e){t.fileName=e}}})},onOk:function(){h({target_id:a.row.target_id,target_name:t.fileName}).then(function(a){0===a.result?(t._taskList(t.params),e.target.innerText="下载"):e.target.innerText="生成"})}})}}},""===a.row.export_url?"生成":"下载"),e("Button",{props:{type:"primary",size:"small",icon:"search"},style:{marginLeft:"5px"},on:{click:function(){t.$router.push({name:"process",params:{targetInfo:a.row,target_id:a.row.target_id}})}}}),e("Button",{props:{type:"error",size:"small",icon:"trash-a"},style:{marginLeft:"5px"},on:{click:function(){t.target_id=a.row.target_id,t.modalDeleter=!0}}})])}}],tasks:[{title:"任务名称",key:"target_name",align:"center",width:250},{title:"任务状态",key:"target_struts",align:"center",width:100,render:function(t,e){return t("span",w[e.row.target_struts])}},{title:"任务目标",key:"target_url",align:"center"},{title:"周期",key:"target_cycle",align:"center",width:60,render:function(t,e){return t("span",b[e.row.target_cycle])}},{title:"策略",key:"target_teststra",align:"center",width:150,render:function(t,e){return t("span",L[e.row.target_teststra])}},{title:"开始时间",key:"target_starttime",align:"center",width:200,render:function(t,e){return t("span",Object(g.a)(new Date(e.row.target_starttime.time)))}},{title:"结束时间",key:"target_endtime",align:"center",width:200,render:function(t,e){return e.row.target_endtime?t("span",Object(g.a)(new Date(e.row.target_endtime.time))):t("span","")}},{title:"报告名称",key:"pdf_name",align:"center"},{title:"操作",align:"center",width:200,render:function(e,a){return e("div",[e("Button",{props:{type:"primary",size:"small",icon:"stop"},style:{marginLeft:"5px"},on:{click:function(){t.$router.push({name:"process",params:{targetInfo:a.row,target_id:a.row.target_id}})}}}),e("a",{attrs:{type:"application/pdf",href:a.row.export_url?""+a.row.export_url:null,download:!!a.row.pdf_name&&a.row.pdf_name},style:{backgroundColor:"#19be6b",display:"inline-block",marginBottom:"0",fontWeight:"400",textAlign:"center",verticalAlign:"middle",touchAction:"manipulation",cursor:"pointer",backgroundImage:"none",border:"1px solid transparent",whiteSpace:"nowrap",lineHeight:"1.5",color:"#fff",padding:"2px 7px",borderRadius:"3px",marginLeft:"5px"},on:{click:function(e){""===a.row.export_url&&t.$Modal.confirm({render:function(e){return e("div",[e("Input",{props:{value:t.fileName,autofocus:!0,placeholder:"请输入文件名"},style:{marginBottom:"15px"},on:{input:function(e){t.fileName=e}}},[e("span",{slot:"prepend"},"报告名称")]),e("Input",{props:{value:t.companyName,autofocus:!0,placeholder:"请输入企业名"},on:{input:function(e){t.companyName=e}}},[e("span",{slot:"prepend"},"企业名称")])])},onOk:function(){h({target_id:a.row.target_id,target_name:t.fileName}).then(function(a){t.fileName="",t.companyName="",0===a.result?(t._taskList(t.params),e.target.innerText="下载"):2===a.result?t.$Message.info("无数据"):e.target.innerText="生成"})}})}}},""===a.row.export_url?"生成":"下载"),e("Button",{props:{type:"primary",size:"small",icon:"search"},style:{marginLeft:"5px"},on:{click:function(){t.$router.push({name:"process",params:{targetInfo:a.row,target_id:a.row.target_id}})}}}),e("Button",{props:{type:"error",size:"small",icon:"trash-a",disabled:"1"===a.row.target_struts},style:{marginLeft:"5px"},on:{click:function(){t.target_id=a.row.target_id,t.modalDeleter=!0}}})])}}],tasksList:[],defaultPage:{area:0,rows:10,page:1,userName:Object(u.b)()},defaultPageTask:{area:0,rows:10,page:1,userName:Object(u.b)()},paramsTask:{},dataTotal:0,dataTotals:0,params:{},urlIpMap:{},target_id:""}},created:function(){this._getAssetURL();var t=this.$route.params;this.data.target_url=t.target_url,this.data.target_ip=t.target_ip,this._getRule(y),this._getRule(v),this.params=l()({},this.defaultPage,{userName:Object(u.b)()}),this.paramsTask=l()({},this.defaultPageTask,{userName:Object(u.b)()}),this._taskList(this.params),this._taskListLong(this.paramsTask)},methods:{_taskList:function(t,e){var a=this,r=l()({},t,{flag:1});this.pageLoading=!0,Object(_.a)(r).then(function(t){0===t.result&&(e&&a.$router.push({name:"process",params:{targetInfo:t.targets[0],target_id:t.targets[0].target_id}}),a.pageLoading=!1,a.tasksList=t.targets,a.dataTotal=t.total)})},_taskListLong:function(t,e){var a=this;this.pagesLoading=!0;var r=l()({},t,{flag:2});Object(_.a)(r).then(function(t){0===t.result&&(e&&a.$router.push({name:"process",params:{targetInfo:t.targets[0],target_id:t.targets[0].target_id}}),a.pagesLoading=!1,a.loadingtasksList=t.targets,a.dataTotals=t.total)})},dataLoad:function(t){this.params=l()({},this.defaultPage,t),this._taskList(this.params)},dataLoads:function(t){this.paramsTask=l()({},this.defaultPageTask,t),this._taskListLong(this.paramsTask)},taskAdd:function(){this.$refs.formValidate.open()},cancel:function(){this.modalDeleter=!1},taskDelete:function(t){var e,a,r=this;(e=t,a=e.target_id,Object(f.a)({method:"post",url:"/ZY/task/deleteTask",data:{target_id:a}})).then(function(t){0===t.result?(r.$Message.success("删除成功"),r.modalDeleter=!1,r._taskList(r.params),r._taskListLong(r.params)):(r.$Message.error("删除失败"),r.modalDeleter=!1)})},asyncOK:function(t){var e=this;this.data.userName=Object(u.b)(),this.data.target_starttime=Object(g.a)(this.data.target_starttime),this.loading=!0,Object(c.a)(t).then(function(t){0===t.result?(e.loading=!1,e.$refs.formValidate.close(),e._taskList(e.params,!0)):2===t.result?(e.$Message.error({content:"资产填写有误或资产不存在"}),e.loading=!1):-1===t.result?(e.$Message.error({content:"添加任务失败"}),e.loading=!1):e.loading=!1})},_getRule:function(t){var e=this;return i()(n.a.mark(function a(){var r;return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(d.a)(t);case 2:0===(r=a.sent).result&&(1===t.flag?e.format[1].option=r.rules.map(function(t){return{value:t.rule_key,name:t.rule_name}}):e.format[2].option=r.rules.map(function(t){return{value:t.rule_key,name:t.rule_name}}));case 4:case"end":return a.stop()}},a,e)}))()},_getAssetURL:function(){var t=this,e={username:Object(u.b)()};Object(k.a)(e).then(function(e){t.urlIpMap={},t.format[4].option=e.lists.map(function(e){return t.urlIpMap[e.assets_url]=e.assets_ip,{value:e.assets_url,name:e.assets_url}}),t.format[5].option=e.lists.map(function(t){return{value:t.assets_ip,name:t.assets_ip}})})}}},O={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"whole logs asset"},[a("section",{staticClass:"assetRight"},[a("div",{staticClass:"assetRight_header"},[a("Input",{staticStyle:{width:"200px"},attrs:{placeholder:"区域",clearable:""},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}}),t._v(" "),a("Button",{attrs:{type:"primary",icon:"ios-search"}},[t._v("搜索")]),t._v(" "),a("Button",{attrs:{type:"primary",icon:"compose"},on:{click:t.taskAdd}},[t._v("添加")])],1),t._v(" "),a("div",{staticClass:"assetRight_contentt"},[a("Card",[a("p",{staticStyle:{"font-size":"16px"},attrs:{slot:"title"},slot:"title"},[t._v("任务状态")]),t._v(" "),a("page",{attrs:{columns:t.tasks,data:t.tasksList,dataTotal:t.dataTotal,loading:t.pageLoading},on:{dataLoad:t.dataLoad}})],1)],1),t._v(" "),a("div",{staticClass:"assetRight_content"},[a("Card",[a("p",{staticStyle:{"font-size":"16px"},attrs:{slot:"title"},slot:"title"},[t._v("周期任务")]),t._v(" "),a("page",{attrs:{columns:t.loadingtasks,data:t.loadingtasksList,dataTotal:t.dataTotals,loading:t.pagesLoading},on:{dataLoad:t.dataLoads}})],1)],1)])]),t._v(" "),a("Modals",{ref:"formValidate",attrs:{format:t.format,data:t.data,title:"添加任务",rules:t.rules,display:t.display,loading:t.loading,ruleValidate:t.rules},on:{asyncOK:t.asyncOK}}),t._v(" "),a("Modal",{attrs:{width:"360","mask-closable":!1},model:{value:t.modalDeleter,callback:function(e){t.modalDeleter=e},expression:"modalDeleter"}},[a("p",{staticStyle:{color:"#f60","text-align":"center"},attrs:{slot:"header"},slot:"header"},[a("Icon",{attrs:{type:"information-circled"}}),t._v(" "),a("span",[t._v("删除确认")])],1),t._v(" "),a("div",{staticStyle:{"text-align":"center"}},[a("p",{staticStyle:{"font-size":"17px"}},[t._v("是否确认删除？")])]),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{loading:t.modal_loading},on:{click:t.cancel}},[t._v("取消")]),t._v(" "),a("Button",{attrs:{type:"error",loading:t.modal_loading},on:{click:function(e){t.taskDelete({target_id:t.target_id})}}},[t._v("删除")])],1)])],1)},staticRenderFns:[]};var j=a("vSla")(x,O,!1,function(t){a("vpO6")},"data-v-3c7dee0e",null);e.default=j.exports},aJHV:function(t,e,a){"use strict";e.a=function(t){var e=t.username;return Object(r.a)({method:"post",url:"/ZY/asset/getAssetURL",data:{username:e}})};var r=a("vLgD")},sMcl:function(t,e,a){"use strict";e.a=function(t){var e=t.flag;return Object(r.a)({method:"post",url:"/ZY/task/getRule",data:{flag:e}})};var r=a("vLgD")},vpO6:function(t,e){}});