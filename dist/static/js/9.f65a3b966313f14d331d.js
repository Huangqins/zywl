webpackJsonp([9],{"+RB0":function(t,e,r){"use strict";e.a=function(t){var e=t.target_name,r=t.target_teststra,s=t.target_cycle,n=t.userName,l=t.target_starttime,o=t.target_url,u=t.target_ip;return Object(a.a)({method:"post",url:"/ZY/task/addTask",data:{target_name:e,target_teststra:r,target_cycle:s,userName:n,target_starttime:l,target_url:o,target_ip:u}})};var a=r("vLgD")},LXEI:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=r("lC5x"),s=r.n(a),n=r("J0Oq"),l=r.n(n),o=r("sMcl"),u=r("+RB0"),i=r("y6zN"),c=r("TIfe"),m=r("V2Kl"),_=r("aJHV"),p={flag:1},g={flag:2},f={name:"firstassetAdd",data:function(){return{urlIpMap:{},iPOption:[],urlOption:[],formItem:{target_name:"",target_teststra:"medium",target_starttime:new Date,target_cycle:"now",target_url:"",target_ip:"",userName:""},strategyRule:[],cycleRule:[],rules:{target_name:[{required:!0,message:"请填写任务名称",trigger:"blur"}]}}},created:function(){this._getRule(p),this._getRule(g);var t=this.$route.params;this.formItem.target_url=t.target_url,this.formItem.target_ip=t.target_ip},watch:{"formItem.target_url":function(t){this.formItem.target_ip=this.urlIpMap[t]}},mounted:function(){this._getAssetURL()},methods:{_taskList:function(t){var e=this;Object(m.a)(t).then(function(t){0===t.result?e.$router.push({name:"process",params:{targetInfo:t.targets[0],target_id:t.targets[0].target_id}}):e.$Message.error("添加错误")})},_getAssetURL:function(){var t=this,e={username:Object(c.b)()};Object(_.a)(e).then(function(e){t.urlIpMap={},t.urlOption=e.lists.map(function(e){return console.log(e),t.urlIpMap[e.assets_url]=e.assets_ip,{value:e.assets_url,name:e.assets_url}}),t.iPOption=e.lists.map(function(t){return{value:t.assets_ip,name:t.assets_ip}}),console.log(t.urlOption,t.iPOption)})},cancel:function(){this.$router.push({path:"/mainpage/homepage"})},asyncOK:function(t){var e=this;this.formItem.userName=Object(c.b)(),this.formItem.target_starttime=Object(i.a)(this.formItem.target_starttime),this.loading=!0,Object(u.a)(this.formItem).then(function(t){0===t.result?(e.loading=!1,e._taskList({area:0,rows:10,page:1,userName:Object(c.b)()})):0===t.result&&e.$Message.error({content:"资产添加有误或资产不存在"})})},_getRule:function(t){var e=this;return l()(s.a.mark(function r(){var a;return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(o.a)(t);case 2:0===(a=r.sent).result&&(1===t.flag?e.strategyRule=a.rules:e.cycleRule=a.rules);case 4:case"end":return r.stop()}},r,e)}))()}}},v={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("div",{staticClass:"whole"},[r("Card",{staticClass:"card"},[r("h2",{staticStyle:{color:"white"},attrs:{slot:"title"},slot:"title"},[t._v("任务添加")]),t._v(" "),r("Row",[r("Form",{ref:"handAdd",attrs:{model:t.formItem,rules:t.rules,"label-width":10}},[r("FormItem",{attrs:{prop:"target_name"}},[r("Input",{attrs:{type:"text",placeholder:"任务名称"},model:{value:t.formItem.target_name,callback:function(e){t.$set(t.formItem,"target_name",e)},expression:"formItem.target_name"}})],1),t._v(" "),r("FormItem",[r("Select",{attrs:{placeholder:"扫描策略"},model:{value:t.formItem.target_teststra,callback:function(e){t.$set(t.formItem,"target_teststra",e)},expression:"formItem.target_teststra"}},t._l(t.strategyRule,function(e){return r("Option",{key:e.rule_key,attrs:{value:e.rule_key}},[t._v(t._s(e.rule_name))])}))],1),t._v(" "),r("FormItem",[r("DatePicker",{attrs:{type:"datetime",placeholder:"开始时间"},model:{value:t.formItem.target_starttime,callback:function(e){t.$set(t.formItem,"target_starttime",e)},expression:"formItem.target_starttime"}})],1),t._v(" "),r("FormItem",{attrs:{prop:"target_cycle"}},[r("Select",{attrs:{placeholder:"扫描周期"},model:{value:t.formItem.target_cycle,callback:function(e){t.$set(t.formItem,"target_cycle",e)},expression:"formItem.target_cycle"}},t._l(t.cycleRule,function(e){return r("Option",{key:e.rule_key,attrs:{value:e.rule_key}},[t._v(t._s(e.rule_name))])}))],1),t._v(" "),r("FormItem",{attrs:{prop:"target_url"}},[r("Select",{attrs:{placeholder:"资产URL"},model:{value:t.formItem.target_url,callback:function(e){t.$set(t.formItem,"target_url",e)},expression:"formItem.target_url"}},t._l(t.urlOption,function(e,a){return r("Option",{key:a,attrs:{value:e.value}},[t._v(t._s(e.name))])}))],1),t._v(" "),r("FormItem",{attrs:{prop:"assets_ip"}},[r("Select",{attrs:{placeholder:"资产IP"},model:{value:t.formItem.target_ip,callback:function(e){t.$set(t.formItem,"target_ip",e)},expression:"formItem.target_ip"}},t._l(t.iPOption,function(e,a){return r("Option",{key:a+"c",attrs:{value:e.value}},[t._v(t._s(e.name))])}))],1)],1),t._v(" "),r("Row",{staticClass:"primary",attrs:{type:"flex",align:"middle",justify:"center"}},[r("Col",[r("i-button",{staticClass:"button",attrs:{type:"primary"},on:{click:t.cancel}},[t._v("取消")]),t._v(" "),r("i-button",{attrs:{type:"primary"},on:{click:t.asyncOK}},[t._v("提交")])],1)],1)],1)],1)],1)])},staticRenderFns:[]};var d=r("vSla")(f,v,!1,function(t){r("Sp3z")},"data-v-e296ea9a",null);e.default=d.exports},Sp3z:function(t,e){},aJHV:function(t,e,r){"use strict";e.a=function(t){var e=t.username;return Object(a.a)({method:"post",url:"/ZY/asset/getAssetURL",data:{username:e}})};var a=r("vLgD")},sMcl:function(t,e,r){"use strict";e.a=function(t){var e=t.flag;return Object(a.a)({method:"post",url:"/ZY/task/getRule",data:{flag:e}})};var a=r("vLgD")}});